<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>ðŸš² Fiets Game Bergen â€“ Route Aâ€“I</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body { margin:0; padding:0; font-family:system-ui,sans-serif; background:#eef2f5; }
.app { padding:16px; max-width:480px; margin:0 auto; }
h1 { font-size:22px; margin-bottom:6px; color:#1e3a8a; }
.subtitle { font-size:14px; color:#555; margin-bottom:16px; }
.location { background:white; border-radius:18px; padding:16px; margin-bottom:14px; box-shadow:0 8px 20px rgba(0,0,0,0.1); display:flex; align-items:center; cursor:pointer; transition:transform .15s; }
.location:hover { transform:scale(1.02); }
.letter { width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:700; margin-right:16px; flex-shrink:0; background:#2563eb; color:white; transition:background .3s; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
.letter.green { background:#16a34a; }
.info { flex:1; }
.name { font-weight:600; font-size:16px; }
.distance { font-size:13px; color:#2563eb; margin-top:4px; }
.tap { font-size:12px; color:#16a34a; font-weight:600; margin-top:4px; }
#popup { position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; z-index:5000; align-items:center; justify-content:center; padding:12px; }
.popup-box { background:white; border-radius:20px; padding:22px; width:100%; max-width:380px; box-sizing:border-box; max-height:85vh; overflow:auto; box-shadow:0 12px 30px rgba(0,0,0,0.2); }
.popup-box h2 { margin-top:0; color:#1e3a8a; font-size:18px; }
.popup-box p { margin-bottom:12px; font-size:14px; }
.popup-box img { width:100%; border-radius:12px; margin-top:10px; }
.popup-box button { margin-top:12px; width:100%; padding:10px; border:none; border-radius:12px; background:#2563eb; color:white; font-size:15px; cursor:pointer; transition:background .2s; }
.popup-box button:hover { background:#1e40af; }
.popup-box button.close { background:#9ca3af; margin-top:8px; }
.popup-box button.close:hover { background:#6b7280; }
</style>
</head>
<body>

<div class="app">
  <h1>ðŸš² Fietsroute</h1>
  <div class="subtitle">Letters zijn blauw. Binnen 200m worden ze groen en kun je erop klikken.</div>
  <div id="list"></div>
  <p id="gpsError" style="font-weight:600;"></p>
</div>

<div id="popup">
  <div class="popup-box">
    <h2 id="popupTitle"></h2>
    <p id="popupText"></p>
    <img id="popupImage" src="" alt="Opdracht foto">
    <button class="close" id="popupClose">Sluiten</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{

// Alle locaties, Muurhuizen 241 als laatste en altijd unlocked
const locaties = [
  { letter:'A', naam:'Bergen Centrum', coords:[52.6696,4.7053], opdracht:'Doe 10 pushups' },
  { letter:'B', naam:'Bergerbos', coords:[52.6739,4.6825], opdracht:'Maak een foto van een boom' },
  { letter:'C', naam:'Schoorlse Duinen', coords:[52.6919,4.6732], opdracht:'Spring drie keer en maak een foto' },
  { letter:'D', naam:'Duinweg Uitzicht', coords:[52.6802,4.6559], opdracht:'Maak een selfie met de duinen op de achtergrond' },
  { letter:'E', naam:'Zeeweg Bosrand', coords:[52.6612,4.6668], opdracht:'Maak een foto van de zee' },
  { letter:'F', naam:'Park Meerwijk', coords:[52.6659,4.7202], opdracht:'Doe een korte meditatie van 1 minuut' },
  { letter:'G', naam:'Bergense Bos', coords:[52.6711,4.6889], opdracht:'Maak een foto met je groep' },
  { letter:'H', naam:'Test', coords:null, opdracht:'Deze locatie is altijd unlocked' } // laatste
];

const images = [
'IMG-20260102-WA0024.jpg','IMG-20260102-WA0023.jpg','IMG-20260102-WA0022.jpg',
'IMG-20260102-WA0021.jpg','IMG-20260102-WA0026.jpg','IMG-20260102-WA0025.jpg',
'IMG-20260102-WA0015.jpg','IMG-20260102-WA0018.jpg','IMG-20260102-WA0014.jpg',
'IMG-20260102-WA0016.jpg','IMG-20260102-WA0020.jpg','IMG-20260102-WA0017.jpg',
'IMG-20260102-WA0019.jpg','IMG-20260102-WA0010.jpg','IMG-20260102-WA0013.jpg',
'IMG-20260102-WA0011.jpg','IMG-20260102-WA0009.jpg','IMG-20260102-WA0008.jpg',
'IMG-20260102-WA0007.jpg','IMG-20260102-WA0004.jpg','IMG-20260102-WA0005.jpg',
'IMG-20260102-WA0006.jpg','IMG-20251206-WA0001.jpg','IMG-20260102-WA0001.jpg',
'IMG-20260102-WA0000.jpg'
];

let userPos = null;
let gpsHistory = [];
const maxHistory = 5;
let lastDistance = {};

// laad unlocked uit localStorage, Test altijd unlocked
let unlocked = JSON.parse(localStorage.getItem('unlocked')) || {};
unlocked['H'] = true;

function saveUnlocked(){
  localStorage.setItem('unlocked', JSON.stringify(unlocked));
}

function render(){
  const list = document.getElementById('list');
  list.innerHTML = '';
  locaties.forEach(l=>{
    const d = lastDistance[l.letter];
    const isGreen = unlocked[l.letter] || (l.coords && d!==undefined && d <= 200);
    if(isGreen) unlocked[l.letter] = true;
    const el = document.createElement('div');
    el.className = 'location';
    el.innerHTML = `
      <div class="letter ${isGreen?'green':''}">${l.letter}</div>
      <div class="info">
        <div class="name">${l.naam}</div>
        ${isGreen || !l.coords?'':`<div class="distance">${d!==undefined?d+' meter':'--'}</div>`}
        ${isGreen?'<div class="tap">Tik om te openen</div>':''}
      </div>`;
    if(isGreen) el.onclick = ()=>openPopup(l);

    // Cheat unlock 10s lang indrukken
    let pressTimer;
    el.addEventListener('mousedown', ()=>{ pressTimer = setTimeout(()=>{ unlocked[l.letter]=true; saveUnlocked(); render(); },10000); });
    el.addEventListener('touchstart', ()=>{ pressTimer = setTimeout(()=>{ unlocked[l.letter]=true; saveUnlocked(); render(); },10000); });
    ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>el.addEventListener(ev, ()=>{ clearTimeout(pressTimer); }));

    list.appendChild(el);
  });
}

// update afstand
function updateDistances(lat,lng){
  locaties.forEach(l=>{
    if(!l.coords) return;
    const d = Math.round(dist(lat,lng,l.coords[0],l.coords[1]));
    lastDistance[l.letter] = d;
    if(d <= 200) unlocked[l.letter] = true;
  });
  saveUnlocked();
  render();
}

// start GPS tracking
function startTracking(){
  if(navigator.geolocation){
    navigator.geolocation.watchPosition(p=>{
      if(p.coords.accuracy > 30) return;
      gpsHistory.push({lat:p.coords.latitude,lng:p.coords.longitude});
      if(gpsHistory.length>maxHistory) gpsHistory.shift();
      const avgLat = gpsHistory.reduce((s,pos)=>s+pos.lat,0)/gpsHistory.length;
      const avgLng = gpsHistory.reduce((s,pos)=>s+pos.lng,0)/gpsHistory.length;
      userPos = {lat:avgLat,lng:avgLng};
      updateDistances(avgLat,avgLng);
      document.getElementById('gpsError').innerText='';
    }, e=>{
      document.getElementById('gpsError').innerText='GPS toegang geweigerd of niet beschikbaar';
    },{ enableHighAccuracy:true, maximumAge:1000, timeout:5000 });
  } else {
    document.getElementById('gpsError').innerText='GPS wordt niet ondersteund in deze browser.';
  }
}

// popup openen
function openPopup(loc){
  document.getElementById('popupTitle').innerText = loc.letter+' â€“ '+loc.naam;
  document.getElementById('popupText').innerText = loc.opdracht;
  const img = document.getElementById('popupImage');
  img.src = images[Math.floor(Math.random()*images.length)];
  document.getElementById('popup').style.display = 'flex';
}

// popup sluiten
function closePopup(){
  document.getElementById('popup').style.display = 'none';
}

// Haversine
function dist(lat1,lon1,lat2,lon2){
  const R=6371e3,toRad=x=>x*Math.PI/180;
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

render();
startTracking();

// Sluiten knop werken ook via keyboard / touch
document.getElementById('popupClose').addEventListener('click', closePopup);

});
</script>

</body>
</html>
