<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>üö≤ Fiets Game Bergen ‚Äì Route A‚ÄìI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
html, body { margin:0; padding:0; height:100%; font-family:system-ui,sans-serif; background:#f6f7f9; }
.app { padding:16px; max-width:480px; margin:0 auto; }
h1 { font-size:20px; margin-bottom:4px; }
.subtitle { font-size:14px; color:#555; margin-bottom:12px; }
.location { background:white; border-radius:14px; padding:14px; margin-bottom:12px; box-shadow:0 6px 16px rgba(0,0,0,0.08); display:flex; align-items:center; cursor:pointer; }
.letter { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:700; margin-right:12px; flex-shrink:0; background:#2563eb; color:white; transition:background .3s; }
.letter.green { background:#16a34a; }
.info { flex:1; }
.name { font-weight:600; }
.distance { font-size:13px; color:#2563eb; }
.tap { font-size:12px; color:#16a34a; font-weight:600; }
.map-btn { position:fixed; top:12px; right:12px; background:#111827; color:white; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; z-index:2000; cursor:pointer; }
#mapOverlay { position:fixed; inset:0; background:white; display:none; z-index:3000; }
#map { height:100%; width:100%; }
.closeMap { position:absolute; top:12px; right:12px; background:#111827; color:white; padding:10px 14px; border-radius:10px; z-index:4000; cursor:pointer; }
.leaflet-control-zoom, .leaflet-control-attribution { display:none !important; }
#popup { position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; z-index:5000; align-items:center; justify-content:center; padding:10px; }
.popup-box { background:white; border-radius:16px; padding:20px; width:100%; max-width:360px; box-sizing:border-box; }
.popup-box h2 { margin-top:0; }
.popup-box p { margin-bottom:10px; }
.popup-box button { margin-top:8px; width:100%; padding:10px; border:none; border-radius:10px; background:#2563eb; color:white; font-size:15px; cursor:pointer; }
.popup-box button.close { background:#9ca3af; }
</style>
</head>
<body>

<div class="map-btn" onclick="openMap()">üó∫Ô∏è</div>

<div class="app">
  <h1>üö≤ Fietsroute</h1>
  <div class="subtitle">Letters zijn blauw. Binnen 100m worden ze groen en kun je erop klikken.</div>
  <div id="list"></div>
</div>

<div id="popup">
  <div class="popup-box">
    <h2 id="popupTitle"></h2>
    <p id="popupText"></p>
    <button id="showAnswer">Toon Antwoord</button>
    <p id="answerText" style="display:none; font-weight:600;"></p>
    <p id="waitText" style="display:none; color:red; font-weight:600;">Je moet 5 minuten wachten!</p>
    <button class="close" onclick="closePopup()">Sluiten</button>
  </div>
</div>

<div id="mapOverlay">
  <div class="closeMap" onclick="closeMap()">Sluiten ‚úï</div>
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{

const locaties = [
  { letter:'A', naam:'Bergen Centrum', coords:[52.6696,4.7053], vraag:'Wat is het oudste gebouw van Bergen?' , antwoord:'De oude Kerk' },
  { letter:'B', naam:'Bergerbos', coords:[52.6739,4.6825], vraag:'Welke boomsoort komt hier het meest voor?', antwoord:'Den' },
  { letter:'C', naam:'Schoorlse Duinen', coords:[52.6919,4.6732], vraag:'Wat is de hoogste duin van Schoorl?', antwoord:'Duin 54 meter' },
  { letter:'D', naam:'Duinweg Uitzicht', coords:[52.6802,4.6559], vraag:'Welke richting zie je de zee?', antwoord:'West' },
  { letter:'E', naam:'Zeeweg Bosrand', coords:[52.6612,4.6668], vraag:'Is er een strand vlakbij?', antwoord:'Ja' },
  { letter:'F', naam:'Park Meerwijk', coords:[52.6659,4.7202], vraag:'Welke kleur heeft het water?', antwoord:'Blauw' },
  { letter:'G', naam:'Bergense Bos', coords:[52.6711,4.6889], vraag:'Hoeveel paden kruisen hier?', antwoord:'3' },
  { letter:'H', naam:'Muurhuizen 241', coords:[52.1563,5.3873], vraag:'In welke stad ligt dit adres?', antwoord:'Amersfoort' },
  { letter:'I', naam:'Terug naar Bergen', coords:[52.6696,4.7053], vraag:'Wie gaat met pensioen?', antwoord:'Marion' }
];

let userPos=null;
let unlocked={}; // letters unlocked

const map=L.map('map',{zoomControl:false}).setView([52.6696,4.7053],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const userMarker=L.circleMarker([0,0],{radius:8,color:'#2563eb',fillOpacity:1}).addTo(map);

function render(){
  const list=document.getElementById('list'); list.innerHTML='';
  locaties.forEach(l=>{
    const d=userPos?Math.round(dist(userPos.lat,userPos.lng,l.coords[0],l.coords[1])):null;
    let isGreen=unlocked[l.letter] || (d!==null && d<100);
    const el=document.createElement('div'); el.className='location';
    el.innerHTML=`
      <div class="letter ${isGreen?'green':''}">${l.letter}</div>
      <div class="info">
        <div class="name">${l.naam}</div>
        <div class="distance">${d!==null?d+' meter':''}</div>
        ${isGreen?'<div class="tap">Tik om te openen</div>':''}
      </div>`;

    if(isGreen) el.onclick=()=>openPopup(l);

    // Cheat: lang indrukken 10s unlock
    let pressTimer;
    el.addEventListener('mousedown', ()=>{ pressTimer=setTimeout(()=>{ unlocked[l.letter]=true; render(); },10000); });
    el.addEventListener('touchstart', ()=>{ pressTimer=setTimeout(()=>{ unlocked[l.letter]=true; render(); },10000); });
    ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>el.addEventListener(ev, ()=>{ clearTimeout(pressTimer); }));

    list.appendChild(el);
  });
}

function check(){
  if(!userPos) return;
  locaties.forEach(l=>{
    const d=dist(userPos.lat,userPos.lng,l.coords[0],l.coords[1]);
    if(d<100 && !unlocked[l.letter]){
      unlocked[l.letter]=true;
    }
  });
  render();
}

navigator.geolocation.watchPosition(p=>{
  userPos={lat:p.coords.latitude,lng:p.coords.longitude};
  userMarker.setLatLng([userPos.lat,userPos.lng]);
  map.setView([userPos.lat,userPos.lng],14);
  check();
},{ enableHighAccuracy:true });

function openPopup(loc){
  document.getElementById('popupTitle').innerText=loc.letter+' ‚Äì '+loc.naam;
  document.getElementById('popupText').innerText=loc.vraag;
  const answerText=document.getElementById('answerText');
  answerText.style.display='none';
  answerText.innerText=loc.antwoord;
  const waitText=document.getElementById('waitText');
  waitText.style.display='none';
  const btn=document.getElementById('showAnswer');
  btn.onclick=()=>{
    answerText.style.display='block';
    waitText.style.display='block'; // show 5 min wait text
  };
  document.getElementById('popup').style.display='flex';
}

function closePopup(){ document.getElementById('popup').style.display='none'; }

function openMap(){
  document.getElementById('mapOverlay').style.display='block';
  setTimeout(()=>{ map.invalidateSize(); },200); // fix blank map
}
function closeMap(){ document.getElementById('mapOverlay').style.display='none'; }

function dist(lat1,lon1,lat2,lon2){
  const R=6371e3,toRad=x=>x*Math.PI/180;
  const dLat=toRad(lat2-lat1),dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

render();

});
</script>
</body>
</html>
